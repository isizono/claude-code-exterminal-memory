---
description: セッション終了前にtranscriptを解析し、トピック・決定事項・タスク・仕様書を一括で記録・更新する
---

# sync_memory

このセッションの会話内容（transcript）を解析し、以下の記録・更新を**すべて実行**してください。

## 実行手順

### 1. トピックの特定・作成 (add_topic)

transcriptを解析し、議論されたテーマを特定する。

**チェック項目:**
- 新しい議論テーマが出ていないか？
- 既存トピックの子トピックとして切り出すべきものはないか？
- トピックが広すぎて分割すべきものはないか？

**アクション:**
- 新しいテーマがあれば `add_topic` で作成
- 親子関係がある場合は `parent_topic_id` を設定

### 2. 決定事項の記録 (add_decision)

合意が成立した内容をすべて記録する。

**決定事項の判定基準:**
- ユーザーが「OK」「それでいこう」「了解」「いいね」等で承認した
- AIの提案に対して明示的な同意があった
- 「〜で決定」「〜に決めた」等の表現がある

**チェック項目:**
- 記録漏れの決定事項はないか？
- 各決定事項は適切なトピックに紐づいているか？
- decision と reason が明確に分離されているか？

**アクション:**
- 未記録の決定事項があれば `add_decision` で記録
- `topic_id` は関連するトピックを指定

### 3. タスクの登録 (add_task)

実装予定・作業予定をすべて登録する。

**タスクの判定基準:**
- 「〜を実装する」「〜を作る」「〜を追加する」
- 「〜が必要」「〜をやる」
- 決定事項から派生する実装作業

**チェック項目:**
- 記録漏れのタスクはないか？
- タスクの粒度は適切か？（1つのPRで完結する程度）
- description に十分な情報があるか？

**アクション:**
- 未登録のタスクがあれば `add_task` で登録
- 関連する仕様書があれば description に参照を含める

### 4. 仕様書の更新

`docs/specs/` 配下に関連する仕様書があれば、決定事項を反映する。

**チェック項目:**
- 新しい決定事項が仕様書に反映されているか？
- 決定事項一覧セクションは最新か？
- 実装タスクセクションは最新か？
- SAレビュー指摘事項は記載されているか？

**アクション:**
- 仕様書を読み込み、未反映の決定事項があれば追記
- 新しいタスクがあれば実装タスクセクションに追加

## 5. 完了報告

以下の形式でサマリーを報告:

```
## sync_memory 完了

### トピック
- 作成: X件
- (作成したトピック名を列挙)

### 決定事項
- 記録: X件
- (記録した決定事項の概要を列挙)

### タスク
- 登録: X件
- (登録したタスク名を列挙)

### 仕様書
- 更新: X件
- (更新したファイル名を列挙)

### 注意事項
- (もしあれば、確認が必要な事項や曖昧な点を記載)
```

## 注意

- **ログ (add_log) は記録しない** - Stopフックで自動記録されるため
- 判断に迷う場合は、記録する方向で進める（後で修正可能）
- 既に記録済みのものは重複して記録しない
