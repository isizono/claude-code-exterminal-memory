# 設計における洞察・学び

このファイルには、議論の中で得られた重要な洞察や気づきを記録する。

## 情報のレイヤーの違い

**日付**: 2025-12-10

**洞察**: パブリックで話す内容と、考える時にretrieveする内容は異なる

**詳細**:
- **パブリックな議論** (GitHub Issue等): 設計判断、意思決定、合意形成。人間も参加しやすい場
- **retrieve対象の詳細情報** (DB内の作業ログ): 具体的に誰がどんな思想でどんな背景でどんなタスクを行ってどんな結果になったか。必要に応じて深掘りするための情報

これらは目的と粒度が異なるため、分離して管理すべきである。

**設計への影響**:
- GitHub Issueを議論の中心に据える
- DBの作業ログは「読もうと思えば読める」補助的な位置づけ
- 両方の役割を明確に区別する

---

## 記録の目的：エージェントのメモリ独立性の解決

**日付**: 2025-12-10

**課題**: エージェントがセッションごとにメモリが独立しているため、同じような間違いを繰り返す

**目的**:
- 次のClaude Codeに知識を引き継ぐ（メイン目的）
- 知識を蓄積することで、前に進めるようにする
- 同じ失敗を繰り返さない

**情報の質の違い**:

1. **task_logs / decisions**:
   - 詳細な作業記録や意思決定
   - 必要に応じてretrieve（検索）して参照
   - 「知ろうと思えば知れる」情報

2. **knowledge / 学び**:
   - retrieveするまでもなく「知っといて欲しい」情報
   - エージェントが常に参照すべき前提知識
   - 自動的に提供される（RAG等で）

**設計への影響**:
- 情報のレイヤーを明確に分ける
- ナレッジは自動提供の仕組みが必要（将来的にRAG）
- 作業ログは検索可能な形で保存

---

## メリット・デメリットは主観であり、理由を明記すべき

**日付**: 2025-12-10

**洞察**: メリット・デメリットを列挙するだけでは不十分。それらは主観的な判断であるため、「なぜそう判断したのか」の根拠を明示すべき。

**悪い例**:
```
候補A: 完全自由記述
- メリット: 柔軟、文脈に応じて詳細度調整可能
- デメリット: 統一性がない、検索しづらい
```

**良い例**:
```
候補A: 完全自由記述
統一性がなく、後続のエージェントが検索しづらい。
理由: 「login.tsx作成」と「login.tsxファイルを作成した」のような表記揺れが発生し、
文字列検索では見落とす可能性が高い。
```

**設計への影響**:
- 提案や選択肢を提示する際は、判断の根拠を明確にする
- 「メリデメ」形式ではなく、「なぜそう考えるか」を説明する
- ドキュメントにも同様の原則を適用する

---

## JSONBは絶対に使うべきでない（構造化データの保存において）

**日付**: 2025-12-10

**洞察**: 外部リンクなど複数の値を保存する場合、JSONBは避けるべき。

**理由**:
- 検索が困難になる
- 型安全性が失われる
- RDBの利点を活かせない

**代替案**:
1. シンプルに単一カラム（TEXT）で1つだけ保存
2. 別テーブルで正規化（複数保存が必要な場合）

**設計への影響**:
- 安易にJSONBを使わず、シンプルな設計を優先する
- 複数保存が必要なら正規化を検討
- 「将来的に複数必要かも」という仮定で過剰設計しない

---

## カラム命名はシンプルで直感的であるべき

**日付**: 2025-12-10

**洞察**: カラム名は後から読む人（人間・AI）が直感的に理解できることが最重要。

**事例**:
- `action/rationale/outcome` → `summary/purpose/result` に変更
- `question` → `matter` に変更

**理由**:
- actionは「行動」のニュアンスが強く、「記録」としては不適切
- rationaleは堅すぎて日常的でない
- matterは「何について」を端的に表現

**設計への影響**:
- カラム名を決める際は複数案を検討
- チーム（今回はユーザーとAI）で納得できる名前にする
- 堅苦しい専門用語より、シンプルで日常的な言葉を優先

---

## 発散と収束を意識した議論プロセスの重要性

**日付**: 2025-12-10

**洞察**: 仕様決定は「発散→収束」のプロセスが不可欠。性急に結論を出すと考慮漏れが発生する。

**問題のある進め方**:
- アクションツール（/speckit.specify等）を最初から実行
- ツールのゴールに引きずられて性急に決定
- 発散的な議論をスキップ

**望ましい進め方**:
1. **発散フェーズ**: 自由に可能性を議論、多角的に検討
2. **質問と確認**: 曖昧な点を明確にする
3. **収束フェーズ**: 双方が納得してから決定
4. **記録**: 決定事項を明確に記録

**設計への影響**:
- 仕様決定ツールは発散が終わってから使う
- 議論中は「提案」と「決定」を明確に区別
- 性急な収束を避け、十分な検討時間を確保

---

## プランモードの本質的価値

**日付**: 2025-12-10

**洞察**: プランモードは単なる作業計画ではなく、「なぜ」を明確にするプロセスである。

**理由**:
- 各todoの「rationale（なぜ）」はプラン時に決まる
- プランなしではtodoが場当たり的になる
- 記録の質はプランの質に依存する

**設計への影響**:
- MCPサーバーのdescriptionにプランモード推奨を明記
- プランなしでの作業を極力避ける
- プラン→実行→記録の流れを標準化

---

## 事実と意見の明確な区別

**日付**: 2025-12-10

**洞察**: RDB（task_logs）には事実のみを記録し、意見・提案・学びは別の場所（knowledge）に記録すべき。

**事実と意見の区別**:
- **事実**: 「login.tsxを作成した」「テストが3件失敗した」
- **意見**: 「このアプローチが最適」「次は〇〇すべき」
- **学び**: 「next_stepsを書くべきでない理由」

**理由**:
- 事実と意見が混在すると、後続のエージェントが判断を誤る
- 意見は時間経過で陳腐化するが、事実は不変
- 記録の信頼性を保つため

**設計への影響**:
- task_logsには改善提案を入れない
- 学びはknowledgeに別途記録
- decisionsテーブルは「決定された意見」として別管理

---

## テンプレートによる記録の質の担保

**日付**: 2025-12-10

**洞察**: 自由記述では記録の質にばらつきが出る。テンプレートで構造化することで質を担保できる。

**事例**:
- tasksのdescription: 目的、背景、完了条件等の構造化
- task_logsのsummary: 実施内容、使用ファイル、差分の構造化

**理由**:
- 後続のエージェントが必要な情報を見つけやすい
- 記録漏れを防ぐ
- 検索性が向上

**注意点**:
- テンプレートは柔軟性も必要
- 堅苦しすぎると使いづらい
- 「軽い構造化」が適切

**設計への影響**:
- 重要な記録にはテンプレートを用意
- MCPツールでテンプレートを提供
- skill等で要約作成を支援
