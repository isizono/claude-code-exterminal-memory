## 決定事項の判定基準と認識合わせプロセス

### 決定事項の判定基準

**決定事項とは**: エージェントが「これであってる？」「この理解で合ってる？」と認識合わせを行い、ユーザーが「OK」「合ってる」と承認したタイミングで確定する。

### 認識合わせ時の必須チェック項目

エージェントが認識合わせを行う際、必ず以下を自己チェックすること：

1. **論点の網羅性**: 認識合わせの話に上がっていない論点は何か？
   - 議論から派生する関連トピックを見落としていないか
   - 影響範囲を十分に考慮しているか

2. **前提の確認**: 前提の確認で漏れているものはないか？
   - ユーザーの発言の背後にある前提を正しく理解しているか
   - 技術的な制約や要件を見落としていないか

3. **性急な結論の回避**: 十分に発散的な議論を経たか？
   - 代替案を検討したか
   - トレードオフを明確にしたか

### フロー

```
1. エージェント: 提案・意見を提示
   ↓
2. 議論・検討（発散フェーズ）
   ↓
3. エージェント: 「〇〇という理解で合ってる？」
   ↓
   ★このタイミングで自己チェック★
   - 他に議論すべき論点はないか？
   - 前提の確認漏れはないか？
   - 性急な結論になっていないか？
   → 不足があれば追加で質問・提案
   ↓
4. ユーザー: 「OK」「合ってる」
   ↓
5. 決定事項として docs/ に記録
```

## 議論状況の継続的な記録

設計議論を行う際は、以下のルールに従って記録を残すこと：

1. **記録場所**
   - `docs/`配下のファイル（特に`project-context.md`等）に議論内容を記録する

2. **記録すべき内容**
   - **決定事項**: 双方が合意した内容
   - **未決定事項・残論点**: まだ議論が必要な項目（これを常にアップデートすること）
   - **提案中**: 検討中の内容
   - **却下事項**: 採用しないと決めた内容（理由も記録）

3. **アップデートのタイミング**
   - 新しい論点が浮上したら即座に追加
   - 議論が解決したら決定事項に移動
   - 却下した案も理由とともに記録

4. **目的**
   - 次セッションでの再開を容易にする
   - `/resume`以外の方法でも議論を継続できるようにする
   - 議論の経緯と現状を明確に保つ

## 開発フロー規約

### コミット規約

**フォーマット**: Conventional Commits形式を使用する

```
<type>: <subject>

<body>（任意）
```

**タイプ一覧**:
- `feat:` - 新機能の追加
- `fix:` - バグ修正
- `docs:` - ドキュメントのみの変更
- `refactor:` - リファクタリング（機能変更なし）
- `test:` - テストの追加・修正
- `chore:` - ビルド、依存関係、その他の雑務

**粒度**: 一言で描写できる程度にまとめる

**例**:
```
feat: tasksテーブルのスキーマを実装
docs: ChromaDB vs pgvectorの調査結果を追加
fix: session_id生成時のUUID形式を修正
```

### ブランチ戦略

**main直push禁止**: pre-pushフックで防止する

**作業方法**: 原則としてgit worktreeを使用する

```bash
# 新しい作業ツリーを作成
git worktree add ../project-name-feature-x feature/feature-x

# 作業完了後
git worktree remove ../project-name-feature-x
```

**ブランチ命名規則**: `feature/<feature-name>`, `fix/<issue-name>` など

### ドキュメント管理

**保存場所**:
- 決定事項、設計ドキュメント: `docs/` 配下
- 調査結果、ナレッジ: `docs/` 配下（将来的に本プロジェクトのMCP経由で管理）

**更新タイミング**:

1. **ナレッジ更新**: web_searchを実施した後、更新要否を判断する
   - 新しい知見が得られた場合は `docs/references/` などに保存
   - 既存ドキュメントに追記すべき情報があれば更新

2. **決定事項更新**: ユーザーとエージェントで合意形成が行われるたびに更新
   - 認識合わせ → ユーザーOK → `docs/` 配下に記録

**ドキュメントテンプレート**: 後日話し合って決定する
